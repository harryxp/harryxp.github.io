<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Peachful Space - Intuition of filterM</title>
        <link href="https://fonts.googleapis.com/css?family=Work+Sans" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Peachful Space</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Intuition of filterM</h1>

            <div class="info">
    Posted on August  7, 2016
    
</div>

<p>In a <a href="a-monadic-way-to-compute-power-set.html">previous post</a>, <code>filterM</code> forms the backbone of the power set computation. Now that we know how it works in this particular case, the next step is to figure out what <code>filterM</code> <em>generally</em> does. Only when we see the connections between that and this particular use can we truly understand its power.</p>
<p>Again, <code>filterM</code>’s definition:</p>
<pre><code>filterM          :: (Monad m) =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m [a]
filterM _ []     =  return []
filterM p (x:xs) =
  p x          &gt;&gt;= \flg -&gt;
  filterM p xs &gt;&gt;= \ys  -&gt;
  return (if flg then x:ys else ys)</code></pre>
<p>It’s reminiscent of <code>filter</code> in that it adds <code>x</code> to <code>ys</code> only when <code>flg</code> is <code>True</code>, but things are more complicated with <code>&gt;&gt;=</code> involved because for each monad it’s different. In this post I’d like to fix <code>Monad m</code> to be the list monad. Hence the predicate <code>a -&gt; m Bool</code> can be things like <code>\_ -&gt; [True,False,True]</code>.</p>
<p>Under this assumption, <code>&gt;&gt;=</code> is just <code>concatMap</code>. Now, <code>filterM</code> is a recursive function, meaning each time it builds on top of the previous invocation. I hope a series of carefully-constructed experiments can illuminate the path:</p>
<pre><code>Prelude Control.Monad&gt; filterM (\_ -&gt; [True]) [1]
[[1]]
Prelude Control.Monad&gt; filterM (\_ -&gt; [True]) [2,1]
[[2,1]]

Prelude Control.Monad&gt; filterM (\_ -&gt; [True,False]) [1]
[[1],[]]
Prelude Control.Monad&gt; filterM (\_ -&gt; [True,False]) [2,1]
[[2,1],[2],[1],[]]

Prelude Control.Monad&gt; filterM (\_ -&gt; [True,True,False]) [1]
[[1],[1],[]]
Prelude Control.Monad&gt; filterM (\_ -&gt; [True,True,False]) [2,1]
[[2,1],[2,1],[2],[2,1],[2,1],[2],[1],[1],[]]</code></pre>
<p>Did you get it? I’d see it this way:</p>
<ol style="list-style-type: decimal">
<li><code>filterM</code> takes two arguments - a predicate and a list, returns a list of lists.</li>
<li>Remember the predicate is applied to each element in the list.</li>
<li>Strip down the argument list to the last element. (First reducing the problem to the bare minimum is a good way to understand recursive algorithms.)</li>
<li>See what comes out of it? Notice how <code>[True,False]</code> corresponds to <code>[[1],[]]</code> and <code>[True,True,False]</code> to <code>[1],[1],[]</code>?</li>
<li>The last two steps describes one single recursion of <code>filterM</code>. Now try more by throwing in <code>2</code>.</li>
<li>Wow, it’s really just taking the result from the previous round and add <code>2</code> or not according to the predicate!</li>
</ol>
<p>Note that we still didn’t go fully general in that our predicate doesn’t do anything with its argument, and the monad is limited to list, but I’m happy with this now. Until next time!</p>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
